<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - Duit</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</head>

<body class="d-flex flex-column min-vh-100 bg-light">
    <div th:replace="~{components/headerPublic :: headerPublic}"></div>
    <main class="flex-fill py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-6 col-lg-5">
                    <div class="card shadow-lg border-0 rounded-4">
                        <div class="card-body p-4">
                            <div class="text-center mb-4">
                                <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
                                    style="width: 60px; height: 60px;">
                                    <i class="bi bi-person-plus text-white fs-3"></i>
                                </div>
                                <h1 class="card-title h3 fw-bold text-primary">Únete a Duit</h1>
                                <p class="text-muted">Crea tu cuenta y comienza a conectar</p>
                            </div>

                            <!-- Mensajes de error -->
                            <div th:if="${error}" class="alert alert-danger alert-dismissible rounded-3 mb-4"
                                role="alert">
                                <i class="bi bi-exclamation-triangle me-2"></i>[[${error}]]
                            </div>

                            <form th:action="@{/register}" method="post" th:object="${registroDTO}">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="firstName" class="form-label fw-semibold">
                                                <i class="bi bi-person text-primary me-1"></i>Nombre *
                                            </label>
                                            <input type="text" id="firstName" name="firstName"
                                                class="form-control form-control-lg rounded-3" th:value="${firstName}"
                                                th:field="*{firstName}"
                                                th:classappend="${#fields.hasErrors('firstName')} ? 'is-invalid' : ''"
                                                placeholder="Ej: Juan" required minlength="2" maxlength="50"
                                                pattern="[A-Za-záéíóúÁÉÍÓÚñÑ\s]+"
                                                title="Solo se permiten letras y espacios">
                                            <div th:if="${#fields.hasErrors('firstName')}" class="invalid-feedback">
                                                <i class="bi bi-exclamation-circle me-1"></i>
                                                <span th:errors="*{firstName}"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="lastName" class="form-label fw-semibold">
                                                <i class="bi bi-person text-primary me-1"></i>Apellidos *
                                            </label>
                                            <input type="text" id="lastName" name="lastName"
                                                class="form-control form-control-lg rounded-3" th:value="${lastName}"
                                                th:field="*{lastName}"
                                                th:classappend="${#fields.hasErrors('lastName')} ? 'is-invalid' : ''"
                                                placeholder="Ej: García López" required minlength="2" maxlength="150"
                                                pattern="[A-Za-záéíóúÁÉÍÓÚñÑ\s]+"
                                                title="Solo se permiten letras y espacios">
                                            <div th:if="${#fields.hasErrors('lastName')}" class="invalid-feedback">
                                                <i class="bi bi-exclamation-circle me-1"></i>
                                                <span th:errors="*{lastName}"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="dni" class="form-label fw-semibold">
                                                <i class="bi bi-card-text text-primary me-1"></i>DNI *
                                            </label>
                                            <input type="text" id="dni" name="dni"
                                                class="form-control form-control-lg rounded-3" th:value="${dni}"
                                                th:field="*{dni}"
                                                th:classappend="${#fields.hasErrors('dni')} ? 'is-invalid' : ''"
                                                placeholder="12345678A" pattern="[0-9]{8}[A-Z]" required
                                                title="El DNI debe tener 8 dígitos seguidos de una letra mayúscula">
                                            <div th:if="${#fields.hasErrors('dni')}" class="invalid-feedback">
                                                <i class="bi bi-exclamation-circle me-1"></i>
                                                <span th:errors="*{dni}"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="phone" class="form-label fw-semibold">
                                                <i class="bi bi-telephone text-primary me-1"></i>Teléfono *
                                            </label>
                                            <input type="tel" id="phone" name="phone"
                                                class="form-control form-control-lg rounded-3" th:value="${phone}"
                                                th:field="*{phone}"
                                                th:classappend="${#fields.hasErrors('phone')} ? 'is-invalid' : ''"
                                                placeholder="Ej: 612345678 o +34612345678" pattern="[+]?[0-9]{9,15}"
                                                maxlength="16" required
                                                title="El teléfono debe tener entre 9 y 15 dígitos, puede empezar con +">
                                            <div th:if="${#fields.hasErrors('phone')}" class="invalid-feedback">
                                                <i class="bi bi-exclamation-circle me-1"></i>
                                                <span th:errors="*{phone}"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="email" class="form-label fw-semibold">
                                        <i class="bi bi-envelope text-primary me-1"></i>Correo electrónico *
                                    </label>
                                    <input type="email" id="email" name="email"
                                        class="form-control form-control-lg rounded-3" th:value="${email}"
                                        th:field="*{email}"
                                        th:classappend="${#fields.hasErrors('email')} ? 'is-invalid' : ''"
                                        placeholder="tu-email@ejemplo.com" required>
                                    <div th:if="${#fields.hasErrors('email')}" class="invalid-feedback">
                                        <i class="bi bi-exclamation-circle me-1"></i>
                                        <span th:errors="*{email}"></span>
                                    </div>
                                </div>

                                <div class="mb-4">
                                    <label for="userType" class="form-label fw-semibold">
                                        <i class="bi bi-people text-primary me-1"></i>Tipo de usuario *
                                    </label>
                                    <select id="userType" name="userType" class="form-select form-select-lg rounded-3"
                                        th:field="*{userType}"
                                        th:classappend="${#fields.hasErrors('userType')} ? 'is-invalid' : ''" required>
                                        <option value="" disabled selected>¿Cómo quieres usar Duit?</option>
                                        <option value="USER" th:selected="${userType == 'USER'}">
                                            <i class="bi bi-search"></i> Usuario estándar - Busco servicios
                                        </option>
                                        <option value="PROFESSIONAL" th:selected="${userType == 'PROFESSIONAL'}">
                                            <i class="bi bi-briefcase"></i> Profesional - Ofrezco servicios
                                        </option>
                                    </select>
                                    <div th:if="${#fields.hasErrors('userType')}" class="invalid-feedback">
                                        <i class="bi bi-exclamation-circle me-1"></i>
                                        <span th:errors="*{userType}"></span>
                                    </div>
                                    <div class="form-text px-2">
                                        <small class="text-muted">
                                            <i class="bi bi-info-circle me-1"></i>
                                            <strong>Usuario estándar:</strong> Solicita servicios a profesionales.<br>
                                            <strong>Profesional:</strong> Ofrece servicios y recibe solicitudes de
                                            trabajo.
                                        </small>
                                    </div>
                                </div>

                                <div class="mb-4">
                                    <label for="password" class="form-label fw-semibold">
                                        <i class="bi bi-lock text-primary me-1"></i>Contraseña *
                                    </label>
                                    <div class="input-group">
                                        <input type="password" id="password" name="password"
                                            class="form-control form-control-lg rounded-start-3" th:field="*{password}"
                                            th:classappend="${#fields.hasErrors('password')} ? 'is-invalid' : ''"
                                            minlength="6" maxlength="100" placeholder="Mínimo 6 caracteres" required
                                            title="La contraseña debe tener al menos 6 caracteres">
                                        <button type="button" class="btn btn-outline-secondary rounded-end-3"
                                            id="togglePasswordRegister">
                                            <i class="bi bi-eye" id="toggleIconRegister"></i>
                                        </button>
                                    </div>
                                    <div th:if="${#fields.hasErrors('password')}" class="invalid-feedback d-block">
                                        <i class="bi bi-exclamation-circle me-1"></i>
                                        <span th:errors="*{password}"></span>
                                    </div>
                                    <div class="form-text px-2">
                                        <small class="text-muted">
                                            <i class="bi bi-shield-check me-1"></i>Usa al menos 6 caracteres para mayor
                                            seguridad
                                        </small>
                                    </div>
                                </div>

                                <div class="d-grid mb-3">
                                    <button type="submit" class="btn btn-primary btn-lg rounded-3 fw-semibold">
                                        <i class="bi bi-person-plus me-2"></i>Crear mi cuenta
                                    </button>
                                </div>
                            </form>

                            <hr class="my-4">

                            <div class="text-center">
                                <p class="text-muted mb-2">¿Ya tienes cuenta?</p>
                                <a th:href="@{/login}" class="btn btn-outline-primary rounded-3">
                                    <i class="bi bi-box-arrow-in-right me-2"></i>Iniciar sesión
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <div th:replace="~{components/footerPublic :: footerPublic}"></div>

    <script>
        // Toggle password visibility
        document.getElementById('togglePasswordRegister').addEventListener('click', function () {
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('toggleIconRegister');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.className = 'bi bi-eye-slash';
            } else {
                passwordInput.type = 'password';
                toggleIcon.className = 'bi bi-eye';
            }
        });
    </script>
</body>

</html>